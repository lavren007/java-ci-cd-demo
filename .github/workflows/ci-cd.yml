name: Java CI/CD Pipeline

# ============================================
# 1. Ð¢Ð Ð˜Ð“Ð“Ð•Ð Ð« (ÐšÐžÐ“Ð”Ð Ð—ÐÐŸÐ£Ð¡ÐšÐÐ¢Ð¬ ÐŸÐÐ™ÐŸÐ›ÐÐ™Ð)
# ============================================
on:
  # Ð—Ð°Ð¿ÑƒÑÐºÐ°Ñ‚ÑŒ Ð¿Ñ€Ð¸ Ð¿ÑƒÑˆÐµ (Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐµ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹) Ð² Ð²ÐµÑ‚ÐºÐ¸ main Ð¸Ð»Ð¸ develop
  push:
    branches: [ "main", "develop" ]
  
  # Ð—Ð°Ð¿ÑƒÑÐºÐ°Ñ‚ÑŒ Ð¿Ñ€Ð¸ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ð¸ Pull Request Ð² Ð²ÐµÑ‚ÐºÑƒ main
  pull_request:
    branches: [ "main" ]
  
  # Ð ÑƒÑ‡Ð½Ð¾Ð¹ Ð·Ð°Ð¿ÑƒÑÐº Ð¸Ð· Ð²ÐºÐ»Ð°Ð´ÐºÐ¸ Actions
  workflow_dispatch:
    inputs:
      reason:
        description: 'ÐŸÑ€Ð¸Ñ‡Ð¸Ð½Ð° Ð·Ð°Ð¿ÑƒÑÐºÐ°'
        required: true
        default: 'Ð ÑƒÑ‡Ð½Ð¾Ð¹ Ð·Ð°Ð¿ÑƒÑÐº'

# ============================================
# 2. ÐžÐŸÐ Ð•Ð”Ð•Ð›Ð•ÐÐ˜Ð• Ð”Ð–ÐžÐ‘ 
# ============================================
jobs:
  # Ð”Ð–ÐžÐ‘Ð 1: Ð¡Ð±Ð¾Ñ€ÐºÐ° Ð¸ Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ
  build-and-test:
    # Ð­Ñ‚Ð° Ð´Ð¶Ð¾Ð±Ð° Ð±ÑƒÐ´ÐµÑ‚ Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½Ð° Ð½Ð° 4 Ñ€Ð°Ð·Ð½Ñ‹Ñ… Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¾Ð½Ð½Ñ‹Ñ… ÑÐ¸ÑÑ‚ÐµÐ¼Ð°Ñ…
    runs-on: ${{ matrix.os }}
    
    # Ð¡Ñ‚Ñ€Ð°Ñ‚ÐµÐ³Ð¸Ñ Ð¼Ð°Ñ‚Ñ€Ð¸Ñ†Ñ‹ Ð¿Ð¾Ð·Ð²Ð¾Ð»ÑÐµÑ‚ Ð·Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ Ð¾Ð´Ð½Ñƒ Ð´Ð¶Ð¾Ð±Ñƒ Ð½Ð° Ð½ÐµÑÐºÐ¾Ð»ÑŒÐºÐ¸Ñ… ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸ÑÑ…
    strategy:
      matrix:
        # ÐžÐ‘ÐÐžÐ’Ð›Ð•ÐÐž: Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ Ð°ÐºÑ‚ÑƒÐ°Ð»ÑŒÐ½Ñ‹Ðµ Ð²ÐµÑ€ÑÐ¸Ð¸ ÐžÐ¡
        os: [ubuntu-latest, macos-latest]
        # ÐŸÐ¾ÑÑÐ½ÐµÐ½Ð¸Ðµ:
        # - ubuntu-latest: Ð¿Ð¾ÑÐ»ÐµÐ´Ð½ÑÑ Ð²ÐµÑ€ÑÐ¸Ñ Ubuntu Linux (24.04)
        # - macos-latest: Ð¿Ð¾ÑÐ»ÐµÐ´Ð½ÑÑ Ð²ÐµÑ€ÑÐ¸Ñ macOS Ð½Ð° Apple Silicon (15.x)
        # Ð”Ð»Ñ Intel Mac Ð¼Ð¾Ð¶Ð½Ð¾ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ macos-15-intel, Ð½Ð¾ Ð¾ÑÑ‚Ð°Ð²Ð¸Ð¼ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ 3 ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹ Ð´Ð»Ñ Ð·Ð°Ð´Ð°Ð½Ð¸Ñ
        
      # fail-fast: false Ð¾Ð·Ð½Ð°Ñ‡Ð°ÐµÑ‚, Ñ‡Ñ‚Ð¾ ÐµÑÐ»Ð¸ Ð¾Ð´Ð½Ð° ÑÐ±Ð¾Ñ€ÐºÐ° ÑƒÐ¿Ð°Ð´ÐµÑ‚, 
      # Ð¾ÑÑ‚Ð°Ð»ÑŒÐ½Ñ‹Ðµ Ð¿Ñ€Ð¾Ð´Ð¾Ð»Ð¶Ð°Ñ‚ Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ñ‚ÑŒ (Ð¼Ð¾Ð¶Ð½Ð¾ Ð¾ÑÑ‚Ð°Ð²Ð¸Ñ‚ÑŒ true Ð´Ð»Ñ Ð·Ð°Ð´Ð°Ð½Ð¸Ñ)
      fail-fast: false
    
    # Ð¨Ð°Ð³Ð¸, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ Ð±ÑƒÐ´ÑƒÑ‚ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ñ‹ Ð½Ð° ÐšÐÐ–Ð”ÐžÐ™ Ð¸Ð· ÑÐ¸ÑÑ‚ÐµÐ¼
    steps:
    # Ð¨ÐÐ“ 1: ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ ÐºÐ¾Ð´ Ð¸Ð· Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ð¸Ñ
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        fetch-depth: 0  # ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ Ð²ÑÑŽ Ð¸ÑÑ‚Ð¾Ñ€Ð¸ÑŽ ÐºÐ¾Ð¼Ð¼Ð¸Ñ‚Ð¾Ð²

    # Ð¨ÐÐ“ 2: ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Java
    - name: Set up JDK 11
      uses: actions/setup-java@v4  # ÐžÐ‘ÐÐžÐ’Ð›Ð•ÐÐž Ð´Ð¾ v4
      with:
        java-version: '11'
        distribution: 'temurin'  # Ð”Ð¸ÑÑ‚Ñ€Ð¸Ð±ÑƒÑ‚Ð¸Ð² Java Ð¾Ñ‚ Eclipse Adoptium
        cache: maven  # ÐšÐµÑˆÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Maven Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹ Ð´Ð»Ñ ÑƒÑÐºÐ¾Ñ€ÐµÐ½Ð¸Ñ ÑÐ±Ð¾Ñ€ÐºÐ¸

    # Ð¨ÐÐ“ 3: ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð²ÐµÑ€ÑÐ¸Ð¹
    - name: Display versions
      run: |
        echo "=== Ð˜ÐÐ¤ÐžÐ ÐœÐÐ¦Ð˜Ð¯ Ðž Ð¡Ð˜Ð¡Ð¢Ð•ÐœÐ• ==="
        echo "ÐžÐ¡: ${{ matrix.os }}"
        echo "Ð Ð°Ð±Ð¾Ñ‡Ð°Ñ Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸Ñ: $(pwd)"
        echo ""
        echo "Java Ð²ÐµÑ€ÑÐ¸Ñ:"
        java -version
        echo ""
        echo "Maven Ð²ÐµÑ€ÑÐ¸Ñ:"
        mvn --version
        echo ""
        echo "Ð¡Ð¿Ð¸ÑÐ¾Ðº Ñ„Ð°Ð¹Ð»Ð¾Ð²:"
        ls -la

    # Ð¨ÐÐ“ 4: Ð¡Ð±Ð¾Ñ€ÐºÐ° Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°
    - name: Build with Maven
      run: mvn clean compile -B
      # ÐžÐ¿Ñ†Ð¸Ð¸:
      # - clean: Ð¾Ñ‡Ð¸ÑÑ‚ÐºÐ° Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰Ð¸Ñ… ÑÐ±Ð¾Ñ€Ð¾Ðº
      # - compile: ÐºÐ¾Ð¼Ð¿Ð¸Ð»ÑÑ†Ð¸Ñ ÐºÐ¾Ð´Ð°
      # - -B: batch mode

    # Ð¨ÐÐ“ 5: Ð—Ð°Ð¿ÑƒÑÐº Ñ‚ÐµÑÑ‚Ð¾Ð²
    - name: Run unit tests
      run: mvn test -B
      # ÐŸÐ¾ÑÐ»Ðµ ÑÑ‚Ð¾Ð³Ð¾ ÑˆÐ°Ð³Ð° Ð¼Ð¾Ð¶Ð½Ð¾ Ð¿Ñ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€ÐµÑ‚ÑŒ Ð¾Ñ‚Ñ‡ÐµÑ‚Ñ‹ Ñ‚ÐµÑÑ‚Ð¾Ð² Ð² Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹ÑÐµ GitHub

    # Ð¨ÐÐ“ 6: Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð¾Ñ‚Ñ‡ÐµÑ‚Ð¾Ð²
    - name: Generate test reports
      if: always()  # Ð’Ñ‹Ð¿Ð¾Ð»Ð½ÑÑ‚ÑŒ Ð²ÑÐµÐ³Ð´Ð°, Ð´Ð°Ð¶Ðµ ÐµÑÐ»Ð¸ Ñ‚ÐµÑÑ‚Ñ‹ ÑƒÐ¿Ð°Ð»Ð¸
      run: |
        echo "=== Ð Ð•Ð—Ð£Ð›Ð¬Ð¢ÐÐ¢Ð« Ð¢Ð•Ð¡Ð¢ÐžÐ’ ==="
        echo "Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð°: ${{ matrix.os }}"
        echo "Ð’Ñ€ÐµÐ¼Ñ: $(date)"
        echo ""
        
        # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð½Ð°Ð»Ð¸Ñ‡Ð¸Ðµ Ð¾Ñ‚Ñ‡ÐµÑ‚Ð¾Ð² Ñ‚ÐµÑÑ‚Ð¾Ð²
        if [ -d "target/surefire-reports" ]; then
          echo "âœ… ÐžÑ‚Ñ‡ÐµÑ‚Ñ‹ Ñ‚ÐµÑÑ‚Ð¾Ð² ÑÐ¾Ð·Ð´Ð°Ð½Ñ‹"
          echo "ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ñ„Ð°Ð¹Ð»Ð¾Ð² Ð¾Ñ‚Ñ‡ÐµÑ‚Ð¾Ð²: $(find target/surefire-reports -name "*.txt" | wc -l)"
        else
          echo "âš ï¸ ÐžÑ‚Ñ‡ÐµÑ‚Ñ‹ Ñ‚ÐµÑÑ‚Ð¾Ð² Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ñ‹"
        fi
        
        # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð½Ð°Ð»Ð¸Ñ‡Ð¸Ðµ JAR Ñ„Ð°Ð¹Ð»Ð¾Ð²
        if [ -d "target" ]; then
          echo "Ð¤Ð°Ð¹Ð»Ñ‹ Ð² target/:"
          ls -la target/
        fi

    # Ð¨ÐÐ“ 7: Ð£Ð¿Ð°ÐºÐ¾Ð²ÐºÐ° Ð² JAR
    - name: Package application
      run: |
        echo "Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ JAR Ñ„Ð°Ð¹Ð»Ð°..."
        mvn package -DskipTests -B
        echo ""
        echo "Ð¡Ð¾Ð·Ð´Ð°Ð½Ð½Ñ‹Ðµ Ñ„Ð°Ð¹Ð»Ñ‹:"
        find target -name "*.jar" -type f | xargs ls -la

    # Ð¨ÐÐ“ 8: Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ Ð°Ñ€Ñ‚ÐµÑ„Ð°ÐºÑ‚Ð¾Ð² (JAR Ñ„Ð°Ð¹Ð»Ð¾Ð²)
    # ÐžÐ‘ÐÐžÐ’Ð›Ð•ÐÐž: Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ Ð°ÐºÑ‚ÑƒÐ°Ð»ÑŒÐ½ÑƒÑŽ Ð²ÐµÑ€ÑÐ¸ÑŽ upload-artifact
    - name: Upload JAR artifact
      uses: actions/upload-artifact@v4  
      with:
        name: app-${{ matrix.os }}-${{ github.run_id }}  # Ð£Ð½Ð¸ÐºÐ°Ð»ÑŒÐ½Ð¾Ðµ Ð¸Ð¼Ñ Ñ ID Ð·Ð°Ð¿ÑƒÑÐºÐ°
        path: |
          target/*.jar
          target/surefire-reports/
        retention-days: 7  # Ð¥Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ Ð°Ñ€Ñ‚ÐµÑ„Ð°ÐºÑ‚Ñ‹ 7 Ð´Ð½ÐµÐ¹
        if-no-files-found: error  # ÐžÑˆÐ¸Ð±ÐºÐ° ÐµÑÐ»Ð¸ Ñ„Ð°Ð¹Ð»Ñ‹ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ñ‹

    # Ð¨ÐÐ“ 9: ÐžÑ‚Ñ‡ÐµÑ‚ Ð¾ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¸Ð¸
    - name: Completion report
      if: always()
      run: |
        echo "========================================"
        echo "ðŸš€ Ð¡Ð‘ÐžÐ ÐšÐ Ð—ÐÐ’Ð•Ð Ð¨Ð•ÐÐ ÐÐ ${{ matrix.os }}"
        echo "========================================"
        echo "Ð¡Ñ‚Ð°Ñ‚ÑƒÑ: ${{ job.status }}"
        echo "ID Ð·Ð°Ð¿ÑƒÑÐºÐ°: ${{ github.run_id }}"
        echo "ÐšÐ¾Ð¼Ð¼Ð¸Ñ‚: ${{ github.sha }}"
        echo "Ð’ÐµÑ‚ÐºÐ°: ${{ github.ref }}"
        echo "========================================"

  # Ð”Ð–ÐžÐ‘Ð 2: ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÐºÐ°Ñ‡ÐµÑÑ‚Ð²Ð° ÐºÐ¾Ð´Ð°
  code-quality:
    # Ð­Ñ‚Ð° Ð´Ð¶Ð¾Ð±Ð° Ð·Ð°Ð²Ð¸ÑÐ¸Ñ‚ Ð¾Ñ‚ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾Ð³Ð¾ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¸Ñ build-and-test
    needs: build-and-test
    runs-on: ubuntu-latest
    
    # Ð’Ñ‹Ð¿Ð¾Ð»Ð½ÑÑ‚ÑŒ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ ÐµÑÐ»Ð¸ build-and-test Ð·Ð°Ð²ÐµÑ€ÑˆÐ¸Ð»ÑÑ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾
    if: ${{ needs.build-and-test.result == 'success' }}
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
    
    - name: Set up JDK 11
      uses: actions/setup-java@v4
      with:
        java-version: '11'
        distribution: 'temurin'
    
    - name: Code quality checks
      run: |
        echo "=== ÐŸÐ ÐžÐ’Ð•Ð ÐšÐ ÐšÐÐ§Ð•Ð¡Ð¢Ð’Ð ÐšÐžÐ”Ð ==="
        echo "1. ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÐ¸Ð½Ñ‚Ð°ÐºÑÐ¸ÑÐ°..."
        mvn clean compile -B
        
        echo ""
        echo "2. Ð—Ð°Ð¿ÑƒÑÐº Ñ‚ÐµÑÑ‚Ð¾Ð² Ñ Ð¾Ñ‚Ñ‡ÐµÑ‚Ð¾Ð¼..."
        mvn test -B
        
        echo ""
        echo "3. ÐÐ½Ð°Ð»Ð¸Ð· Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹..."
        mvn dependency:tree -DoutputFile=dependencies.txt
        
        echo ""
        echo "4. ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÑ‚Ð¸Ð»Ñ ÐºÐ¾Ð´Ð° "
        echo "Ð—Ð´ÐµÑÑŒ Ð¼Ð¾Ð¶Ð½Ð¾ Ð´Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ:"
        echo "- Checkstyle Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸ ÑÑ‚Ð¸Ð»Ñ ÐºÐ¾Ð´Ð°"
        echo "- SpotBugs Ð´Ð»Ñ Ð¿Ð¾Ð¸ÑÐºÐ° Ð±Ð°Ð³Ð¾Ð²"
        echo "- PMD Ð´Ð»Ñ ÑÑ‚Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ð³Ð¾ Ð°Ð½Ð°Ð»Ð¸Ð·Ð°"
        echo "- JaCoCo Ð´Ð»Ñ Ð°Ð½Ð°Ð»Ð¸Ð·Ð° Ð¿Ð¾ÐºÑ€Ñ‹Ñ‚Ð¸Ñ ÐºÐ¾Ð´Ð°"
        
        echo ""
        echo "=== Ð Ð•Ð—Ð£Ð›Ð¬Ð¢ÐÐ¢Ð« ==="
        echo "âœ… ÐšÐ¾Ð¼Ð¿Ð¸Ð»ÑÑ†Ð¸Ñ ÑƒÑÐ¿ÐµÑˆÐ½Ð°"
        echo "âœ… Ð¢ÐµÑÑ‚Ñ‹ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ñ‹"
        echo "âœ… Ð—Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸ Ð¿Ñ€Ð¾Ð°Ð½Ð°Ð»Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ð½Ñ‹"
    
    - name: Upload quality report
      uses: actions/upload-artifact@v4
      with:
        name: quality-report
        path: |
          dependencies.txt
          target/surefire-reports/
        retention-days: 7

  # Ð”Ð–ÐžÐ‘Ð 3: Ð”ÐµÐ¿Ð»Ð¾Ð¹ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ
  deploy:
    # Ð­Ñ‚Ð° Ð´Ð¶Ð¾Ð±Ð° Ð·Ð°Ð²Ð¸ÑÐ¸Ñ‚ Ð¾Ñ‚ Ð£Ð¡ÐŸÐ•Ð¨ÐÐžÐ“Ðž Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¸Ñ build-and-test Ð¸ code-quality
    needs: 
      - build-and-test
      - code-quality
    # Ð—Ð°Ð¿ÑƒÑÐºÐ°Ñ‚ÑŒ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð¿Ñ€Ð¸ Ð¿ÑƒÑˆÐµ Ð² main (Ð½Ðµ Ð¿Ñ€Ð¸ Pull Request)
    if: |
      github.event_name == 'push' && 
      github.ref == 'refs/heads/main' &&
      needs.build-and-test.result == 'success' &&
      needs.code-quality.result == 'success'
    
    runs-on: ubuntu-latest
    
    steps:
    # Ð¨ÐÐ“ 1: Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð°Ñ€Ñ‚ÐµÑ„Ð°ÐºÑ‚Ð° Ñ JAR Ñ„Ð°Ð¹Ð»Ð¾Ð¼
    - name: Download build artifact
      uses: actions/download-artifact@v4  
      with:
        pattern: app-ubuntu-latest-*  # Ð—Ð°Ð³Ñ€ÑƒÐ¶Ð°ÐµÐ¼ Ð°Ñ€Ñ‚ÐµÑ„Ð°ÐºÑ‚ Ñ Ubuntu
        merge-multiple: true
    
    # Ð¨ÐÐ“ 2: ÐŸÐ¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸ÑŽ Ð¾ Ñ„Ð°Ð¹Ð»Ð°Ñ…
    - name: List files for deployment
      run: |
        echo "=== Ð¤ÐÐ™Ð›Ð« Ð“ÐžÐ¢ÐžÐ’Ð«Ð• Ðš Ð”Ð•ÐŸÐ›ÐžÐ® ==="
        echo "Ð¢ÐµÐºÑƒÑ‰Ð°Ñ Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸Ñ: $(pwd)"
        echo ""
        echo "Ð¡Ð¾Ð´ÐµÑ€Ð¶Ð¸Ð¼Ð¾Ðµ:"
        ls -la
        echo ""
        echo "JAR Ñ„Ð°Ð¹Ð»Ñ‹:"
        find . -name "*.jar" -type f -exec ls -la {} \;
        echo ""
        echo "ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ JAR Ñ„Ð°Ð¹Ð»Ð¾Ð²: $(find . -name "*.jar" -type f | wc -l)"
    
    # Ð¨ÐÐ“ 3: Ð”ÐµÐ¼Ð¾Ð½ÑÑ‚Ñ€Ð°Ñ†Ð¸Ñ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ
    - name: Test the application
      run: |
        echo "=== Ð¢Ð•Ð¡Ð¢Ð˜Ð ÐžÐ’ÐÐÐ˜Ð• ÐŸÐ Ð˜Ð›ÐžÐ–Ð•ÐÐ˜Ð¯ ==="
        
        # Ð˜Ñ‰ÐµÐ¼ Ð¾ÑÐ½Ð¾Ð²Ð½Ð¾Ð¹ JAR Ñ„Ð°Ð¹Ð»
        MAIN_JAR=$(find . -name "*jar-with-dependencies.jar" -type f | head -1)
        
        if [ -f "$MAIN_JAR" ]; then
          echo "âœ… ÐÐ°Ð¹Ð´ÐµÐ½ Ð¾ÑÐ½Ð¾Ð²Ð½Ð¾Ð¹ JAR Ñ„Ð°Ð¹Ð»: $MAIN_JAR"
          echo "   Ð Ð°Ð·Ð¼ÐµÑ€: $(du -h "$MAIN_JAR" | cut -f1)"
          echo "   MD5 ÑÑƒÐ¼Ð¼Ð°: $(md5sum "$MAIN_JAR" | cut -d' ' -f1)"
          echo ""
          
          echo "Ð—Ð°Ð¿ÑƒÑÐº Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ Ð´Ð»Ñ Ñ‚ÐµÑÑ‚Ð°:"
          echo "---------------------------"
          timeout 10s java -jar "$MAIN_JAR" || echo "ÐŸÑ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ Ð·Ð°Ð²ÐµÑ€ÑˆÐ¸Ð»Ð¾ Ñ€Ð°Ð±Ð¾Ñ‚Ñƒ"
          echo "---------------------------"
          echo "âœ… ÐŸÑ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ Ð·Ð°Ð¿ÑƒÑÐºÐ°ÐµÑ‚ÑÑ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾"
        else
          echo "âŒ ÐžÑÐ½Ð¾Ð²Ð½Ð¾Ð¹ JAR Ñ„Ð°Ð¹Ð» Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½"
          echo "Ð”Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹Ðµ Ñ„Ð°Ð¹Ð»Ñ‹:"
          find . -name "*.jar" -type f
          exit 1
        fi
    
    # Ð¨ÐÐ“ 4: ÐŸÐ¾Ð´Ð³Ð¾Ñ‚Ð¾Ð²ÐºÐ° Ðº Ð´ÐµÐ¿Ð»Ð¾ÑŽ 
    - name: Prepare for deployment
      run: |
        echo "=== ÐŸÐžÐ”Ð“ÐžÐ¢ÐžÐ’ÐšÐ Ðš Ð”Ð•ÐŸÐ›ÐžÐ® ==="
        
        # Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ð¿Ñ€Ð¾ÑÑ‚Ð¾Ð¹ ÑÐºÑ€Ð¸Ð¿Ñ‚ Ð´ÐµÐ¿Ð»Ð¾Ñ (Ð´Ð»Ñ Ð´ÐµÐ¼Ð¾Ð½ÑÑ‚Ñ€Ð°Ñ†Ð¸Ð¸)
        cat > deploy.sh << 'EOF'
        #!/bin/bash
        echo "Ð¡ÐºÑ€Ð¸Ð¿Ñ‚ Ð´ÐµÐ¿Ð»Ð¾Ñ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ"
        echo "Ð˜ÑÐ¿Ð¾Ð»Ð½ÑÐµÐ¼Ñ‹Ð¹ Ñ„Ð°Ð¹Ð»: $1"
        echo "Ð¦ÐµÐ»ÐµÐ²Ð¾Ð¹ ÑÐµÑ€Ð²ÐµÑ€: \$SSH_HOST"
        echo ""
        echo "ÐšÐ¾Ð¼Ð°Ð½Ð´Ñ‹ Ð´Ð»Ñ Ñ€ÐµÐ°Ð»ÑŒÐ½Ð¾Ð³Ð¾ Ð´ÐµÐ¿Ð»Ð¾Ñ:"
        echo "1. scp \$1 user@server:/opt/app/"
        echo "2. ssh user@server 'systemctl restart myapp'"
        echo "3. ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÑ‚Ð°Ñ‚ÑƒÑÐ°: ssh user@server 'systemctl status myapp'"
        EOF
        
        chmod +x deploy.sh
        echo "Ð¡Ð¾Ð·Ð´Ð°Ð½ ÑÐºÑ€Ð¸Ð¿Ñ‚ deploy.sh"
    
    # Ð¨ÐÐ“ 5: Ð¡Ð¸Ð¼ÑƒÐ»ÑÑ†Ð¸Ñ Ð´ÐµÐ¿Ð»Ð¾Ñ
    - name: Simulate deployment
      run: |
        echo "=== Ð¡Ð˜ÐœÐ£Ð›Ð¯Ð¦Ð˜Ð¯ Ð”Ð•ÐŸÐ›ÐžÐ¯ ==="
        echo ""
        echo "Ð­Ñ‚Ð°Ð¿Ñ‹ Ð´ÐµÐ¿Ð»Ð¾Ñ:"
        echo "1. âœ… ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð°Ñ€Ñ‚ÐµÑ„Ð°ÐºÑ‚Ð¾Ð²"
        echo "2. âœ… Ð’Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ñ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸"
        echo "3. â³ ÐžÑ‚Ð¿Ñ€Ð°Ð²ÐºÐ° Ð½Ð° ÑÐµÑ€Ð²ÐµÑ€ (ÑÐ¸Ð¼ÑƒÐ»ÑÑ†Ð¸Ñ)..."
        sleep 2
        echo "4. âœ… Ð¤Ð°Ð¹Ð»Ñ‹ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ñ‹"
        echo "5. â³ ÐŸÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÐº ÑÐµÑ€Ð²Ð¸ÑÐ° (ÑÐ¸Ð¼ÑƒÐ»ÑÑ†Ð¸Ñ)..."
        sleep 2
        echo "6. âœ… Ð¡ÐµÑ€Ð²Ð¸Ñ Ð¿ÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑ‰ÐµÐ½"
        echo "7. â³ ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð·Ð´Ð¾Ñ€Ð¾Ð²ÑŒÑ (ÑÐ¸Ð¼ÑƒÐ»ÑÑ†Ð¸Ñ)..."
        sleep 2
        echo "8. âœ… ÐŸÑ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð¾"
        echo ""
        echo "ðŸŽ‰ Ð”Ð•ÐŸÐ›ÐžÐ™ Ð£Ð¡ÐŸÐ•Ð¨ÐÐž Ð—ÐÐ’Ð•Ð Ð¨Ð•Ð!"
    
    # Ð¨ÐÐ“ 6: Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð¾Ñ‚Ñ‡ÐµÑ‚Ð° Ð¾ Ð´ÐµÐ¿Ð»Ð¾Ðµ
    - name: Create deployment report
      run: |
        echo "=== ÐžÐ¢Ð§Ð•Ð¢ Ðž Ð”Ð•ÐŸÐ›ÐžÐ• ==="
        echo ""
        
        # Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ð¾Ñ‚Ñ‡ÐµÑ‚ Ð² Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ðµ JSON
        cat > deployment-report.json << EOF
        {
          "deployment": {
            "status": "success",
            "timestamp": "$(date -u +"%Y-%m-%dT%H:%M:%SZ")",
            "application": {
              "name": "java-ci-cd-demo",
              "version": "1.0.0",
              "build_id": "${{ github.run_id }}",
              "commit": "${{ github.sha }}"
            },
            "environment": {
              "os": "ubuntu-latest",
              "java_version": "11",
              "runner": "github-actions"
            },
            "artifacts": [
              {
                "type": "jar",
                "count": $(find . -name "*.jar" -type f | wc -l)
              }
            ],
            "testing": {
              "platforms_tested": 3,
              "result": "all_passed"
            }
          }
        }
        EOF
        
        echo "Ð¡Ð¾Ð·Ð´Ð°Ð½ Ð¾Ñ‚Ñ‡ÐµÑ‚: deployment-report.json"
        echo ""
        cat deployment-report.json
    
    # Ð¨ÐÐ“ 7: Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ Ð¾Ñ‚Ñ‡ÐµÑ‚Ð¾Ð²
    - name: Upload deployment artifacts
      uses: actions/upload-artifact@v4
      with:
        name: deployment-artifacts
        path: |
          deployment-report.json
          deploy.sh
          *.jar
        retention-days: 30
    
    # Ð¨ÐÐ“ 8: Ð¤Ð¸Ð½Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¾Ñ‚Ñ‡ÐµÑ‚
    - name: Final report
      run: |
        echo ""
        echo "===================================================="
        echo "              ðŸŽ‰ CI/CD ÐŸÐÐ™ÐŸÐ›ÐÐ™Ð Ð—ÐÐ’Ð•Ð Ð¨Ð•Ð            "
        echo "===================================================="
        echo ""
        echo "ðŸ“Š Ð¡Ð¢ÐÐ¢Ð˜Ð¡Ð¢Ð˜ÐšÐ:"
        echo "   â€¢ ÐžÐ¿ÐµÑ€Ð°Ñ†Ð¸Ð¾Ð½Ð½Ñ‹Ðµ ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹: 2"
        echo "   â€¢ Ð¢ÐµÑÑ‚Ñ‹ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ñ‹: âœ… Ð”Ð°"
        echo "   â€¢ ÐšÐ°Ñ‡ÐµÑÑ‚Ð²Ð¾ ÐºÐ¾Ð´Ð°: âœ… ÐŸÑ€Ð¾Ð²ÐµÑ€ÐµÐ½Ð¾"
        echo "   â€¢ Ð”ÐµÐ¿Ð»Ð¾Ð¹: âœ… Ð£ÑÐ¿ÐµÑˆÐ½Ð¾ (ÑÐ¸Ð¼ÑƒÐ»ÑÑ†Ð¸Ñ)"
        echo ""
        echo "ðŸ“¦ ÐÐ Ð¢Ð•Ð¤ÐÐšÐ¢Ð«:"
        echo "   â€¢ JAR Ñ„Ð°Ð¹Ð»Ñ‹: Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹ Ð´Ð»Ñ ÑÐºÐ°Ñ‡Ð¸Ð²Ð°Ð½Ð¸Ñ"
        echo "   â€¢ ÐžÑ‚Ñ‡ÐµÑ‚Ñ‹ Ñ‚ÐµÑÑ‚Ð¾Ð²: ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ñ‹"
        echo "   â€¢ ÐžÑ‚Ñ‡ÐµÑ‚ Ð´ÐµÐ¿Ð»Ð¾Ñ: deployment-report.json"
        echo ""
        echo "ðŸ”— Ð¡Ð¡Ð«Ð›ÐšÐ˜:"
        echo "   â€¢ Ð ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ð¸Ð¹: ${{ github.server_url }}/${{ github.repository }}"
        echo "   â€¢ Workflow: ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}"
        echo "   â€¢ ÐšÐ¾Ð¼Ð¼Ð¸Ñ‚: ${{ github.server_url }}/${{ github.repository }}/commit/${{ github.sha }}"
        echo ""
        echo "===================================================="
